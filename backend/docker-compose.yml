version: '3.8'

services:
  # 网关服务
  gateway:
    build:
      context: .
      dockerfile: ./walking-pet-gateway/Dockerfile
    container_name: walking-pet-gateway
    ports:
      - "8000:8000"
    environment:
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
    networks:
      - walking-pet-network

  # 用户服务
  user-service:
    build:
      context: .
      dockerfile: ./walking-pet-user-service/Dockerfile
    container_name: walking-pet-user-service
    ports:
      - "8001:8001"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://host.docker.internal:3306/walking_pet_user?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
    networks:
      - walking-pet-network

  # 宠物服务
  pet-service:
    build:
      context: .
      dockerfile: ./walking-pet-pet-service/Dockerfile
    container_name: walking-pet-pet-service
    ports:
      - "8002:8002"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://host.docker.internal:3306/walking_pet_pet?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
    networks:
      - walking-pet-network

  # 公告服务
  bulletin-service:
    build:
      context: .
      dockerfile: ./walking-pet-bulletin-service/Dockerfile
    container_name: walking-pet-bulletin-service
    ports:
      - "8003:8003"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://host.docker.internal:3306/walking_pet_bulletin?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
    networks:
      - walking-pet-network

  # 宠托师服务
  sitter-service:
    build:
      context: .
      dockerfile: ./walking-pet-sitter-service/Dockerfile
    container_name: walking-pet-sitter-service
    ports:
      - "8004:8004"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://host.docker.internal:3306/walking_pet_sitter?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
    networks:
      - walking-pet-network

  # 订单服务
  order-service:
    build:
      context: .
      dockerfile: ./walking-pet-order-service/Dockerfile
    container_name: walking-pet-order-service
    ports:
      - "8005:8005"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://host.docker.internal:3306/walking_pet_order?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR: host.docker.internal:8848
      SITTER_SERVICE_URL: http://sitter-service:8004
    networks:
      - walking-pet-network

networks:
  walking-pet-network:
    driver: bridge

volumes: {}