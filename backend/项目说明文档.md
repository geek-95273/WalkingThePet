# Walking Pet - å® ç‰©é›å…»æœåŠ¡å¹³å° é¡¹ç›®è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®èƒŒæ™¯åŠæ„ä¹‰](#é¡¹ç›®èƒŒæ™¯åŠæ„ä¹‰)
2. [æŠ€æœ¯æ ˆåŠæ¶æ„è®¾è®¡](#æŠ€æœ¯æ ˆåŠæ¶æ„è®¾è®¡)
3. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
4. [å…³é”®æŠ€æœ¯åŠè§£å†³æ–¹æ¡ˆ](#å…³é”®æŠ€æœ¯åŠè§£å†³æ–¹æ¡ˆ)
5. [æ ¸å¿ƒä»£ç ä½ç½®åŠå®ç°](#æ ¸å¿ƒä»£ç ä½ç½®åŠå®ç°)

---

## ä¸€ã€é¡¹ç›®èƒŒæ™¯åŠæ„ä¹‰

### 1.1 é¡¹ç›®èƒŒæ™¯

éšç€åŸå¸‚åŒ–è¿›ç¨‹åŠ å¿«ï¼Œè¶Šæ¥è¶Šå¤šçš„å¹´è½»äººé€‰æ‹©å…»å® ç‰©ä½œä¸ºç”Ÿæ´»ä¼´ä¾£ã€‚ç„¶è€Œï¼Œç”±äºå·¥ä½œç¹å¿™ã€å‡ºå·®æ—…è¡Œç­‰åŸå› ï¼Œå® ç‰©ä¸»äººå¸¸å¸¸æ— æ³•æŒ‰æ—¶å–‚å…»å’Œé›å® ï¼Œå¯¼è‡´å® ç‰©å¾—ä¸åˆ°è‰¯å¥½ç…§é¡¾ã€‚åŒæ—¶ï¼Œè®¸å¤šçˆ±å® äººå£«å¸Œæœ›é€šè¿‡æä¾›å® ç‰©ç…§é¡¾æœåŠ¡è·å¾—æ”¶å…¥ï¼Œä½†ç¼ºä¹ä¸€ä¸ªå¯é çš„å¹³å°è¿›è¡Œæ’®åˆã€‚

### 1.2 é¡¹ç›®æ„ä¹‰

**Walking Petï¼ˆé›å® ç³»ç»Ÿï¼‰**æ˜¯ä¸€ä¸ªåŸºäºSpring Cloudå¾®æœåŠ¡æ¶æ„çš„å® ç‰©é›å…»æœåŠ¡å¹³å°ï¼Œè‡´åŠ›äºè§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

1. **ä¾¿æ·æ€§**ï¼šå® ç‰©ä¸»äººå¯ä»¥éšæ—¶éšåœ°å‘å¸ƒé›å® éœ€æ±‚ï¼Œæ— éœ€äº²è‡ªç…§é¡¾å® ç‰©
2. **å¯é æ€§**ï¼šé€šè¿‡å¹³å°è®¤è¯çš„å® æ‰˜å¸ˆæä¾›ä¸“ä¸šæœåŠ¡ï¼Œä¿éšœå® ç‰©å®‰å…¨
3. **é€æ˜åŒ–**ï¼šå®Œæ•´çš„è®¢å•æµç¨‹è®°å½•ï¼ŒæœåŠ¡å®Œæˆåä¸Šä¼ å›¾ç‰‡åé¦ˆ
4. **åŒå‘é€‰æ‹©**ï¼šä¸»äººå¯æŸ¥çœ‹é›å® å¸ˆè¯„ä»·å’Œå†å²è®¢å•ï¼Œé›å® å¸ˆå¯æ ¹æ®å® ç‰©ä¿¡æ¯é€‰æ‹©æ¥å•

### 1.3 æ ¸å¿ƒåŠŸèƒ½

- **ç”¨æˆ·ç®¡ç†**ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€èº«ä»½è®¤è¯
- **å® ç‰©æ¡£æ¡ˆ**ï¼šåˆ›å»ºå’Œç®¡ç†å® ç‰©å¥åº·æ¡£æ¡ˆ
- **é›å® å…¬å‘Š**ï¼šå‘å¸ƒä¸Šé—¨å–‚çŒ«/é›ç‹—éœ€æ±‚
- **é›å® å¸ˆå…¥é©»**ï¼šä¸“ä¸šé›å® å¸ˆè®¤è¯å’Œä¿¡æ¯å±•ç¤º
- **è®¢å•ç®¡ç†**ï¼šè®¢å•åˆ›å»ºã€æ¥å•ã€å®Œæˆã€è¯„ä»·å…¨æµç¨‹
- **æœåŠ¡åé¦ˆ**ï¼šé›å® å¸ˆå®ŒæˆæœåŠ¡åä¸Šä¼ å›¾ç‰‡å’Œæ–‡å­—åé¦ˆ

---

## äºŒã€æŠ€æœ¯æ ˆåŠæ¶æ„è®¾è®¡

### 2.1 æŠ€æœ¯æ ˆæ€»è§ˆ

#### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Java** | 1.8 | å¼€å‘è¯­è¨€ |
| **Spring Boot** | 2.7.18 | å¾®æœåŠ¡æ¡†æ¶ |
| **Spring Cloud** | 2021.0.8 | å¾®æœåŠ¡æ²»ç† |
| **Spring Cloud Alibaba** | 2021.0.5.0 | æœåŠ¡æ³¨å†Œä¸é…ç½® |
| **Spring Cloud Gateway** | - | APIç½‘å…³ |
| **Spring Cloud OpenFeign** | - | å£°æ˜å¼HTTPå®¢æˆ·ç«¯ |
| **Spring Cloud LoadBalancer** | - | è´Ÿè½½å‡è¡¡ |
| **Nacos** | 2.2.0 | æœåŠ¡æ³¨å†Œä¸å‘ç° |
| **MyBatis Plus** | 3.5.3.1 | ORMæ¡†æ¶ |
| **MySQL** | 8.0.33 | å…³ç³»å‹æ•°æ®åº“ |
| **JWT** | 0.11.5 | èº«ä»½è®¤è¯ |
| **Hutool** | 5.8.23 | Javaå·¥å…·åº“ |
| **Lombok** | 1.18.30 | ä»£ç ç®€åŒ– |
| **Docker** | - | å®¹å™¨åŒ–éƒ¨ç½² |
| **Docker Compose** | 3.8 | å®¹å™¨ç¼–æ’ |

#### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Vue.js** | 3.x | å‰ç«¯æ¡†æ¶ |
| **Vue Router** | 4.x | è·¯ç”±ç®¡ç† |
| **Axios** | - | HTTPè¯·æ±‚ |
| **Vite** | - | æ„å»ºå·¥å…· |

### 2.2 ç³»ç»Ÿæ¶æ„è®¾è®¡

#### 2.2.1 å¾®æœåŠ¡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·/å‰ç«¯                              â”‚
â”‚                  (Vue.js + Axios)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPè¯·æ±‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Gateway (8000)                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  - JWT TokenéªŒè¯                                     â”‚   â”‚
â”‚   â”‚  - ç»Ÿä¸€è·¯ç”±è½¬å‘                                       â”‚   â”‚
â”‚   â”‚  - CORSè·¨åŸŸé…ç½®                                       â”‚   â”‚
â”‚   â”‚  - è´Ÿè½½å‡è¡¡                                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚       â”‚       â”‚       â”‚
        â†“       â†“       â†“       â†“       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚User       â”‚Pet    â”‚Bulletinâ”‚Sitter â”‚Order      â”‚
â”‚Service    â”‚Serviceâ”‚Serviceâ”‚Serviceâ”‚Service    â”‚
â”‚(8001)     â”‚(8002) â”‚(8003) â”‚(8004) â”‚(8005)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ç”¨æˆ·æ³¨å†Œ    â”‚å® ç‰©æ¡£æ¡ˆâ”‚é›å® å…¬å‘Šâ”‚é›å® å¸ˆ  â”‚è®¢å•ç®¡ç†   â”‚
â”‚ç”¨æˆ·ç™»å½•    â”‚å¢åˆ æ”¹æŸ¥â”‚éœ€æ±‚å‘å¸ƒâ”‚å…¥é©»è®¤è¯â”‚è®¢å•åˆ›å»º   â”‚
â”‚JWTç”Ÿæˆ    â”‚å›¾ç‰‡å­˜å‚¨â”‚å…¬å‘Šç®¡ç†â”‚ä¿¡æ¯å±•ç¤ºâ”‚æ¥å•å®Œæˆ   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚         â”‚       â”‚       â”‚         â”‚
      â”‚         â”‚       â”‚       â”‚         â”‚ OpenFeignè°ƒç”¨
      â”‚         â”‚       â”‚       â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Sitter
      â”‚         â”‚       â”‚       â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Pet
      â†“         â†“       â†“       â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Nacos (8848)                               â”‚
â”‚              æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­å¿ƒ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“         â†“       â†“       â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚walking_ â”‚walkingâ”‚walkingâ”‚walkingâ”‚walking_   â”‚
â”‚pet_user â”‚_pet   â”‚_pet   â”‚_pet   â”‚pet_order  â”‚
â”‚         â”‚_pet   â”‚_bulletinâ”‚_sitterâ”‚          â”‚
â”‚MySQL    â”‚MySQL  â”‚MySQL  â”‚MySQL  â”‚MySQL      â”‚
â”‚(3306)   â”‚(3306) â”‚(3306) â”‚(3306) â”‚(3306)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 å¾®æœåŠ¡åˆ—è¡¨

| æœåŠ¡åç§° | ç«¯å£ | æ•°æ®åº“ | ä¸»è¦èŒè´£ | ä¾èµ–æœåŠ¡ |
|---------|------|--------|---------|---------|
| **gateway-service** | 8000 | - | APIç½‘å…³ã€JWTéªŒè¯ã€è·¯ç”±è½¬å‘ | Nacos |
| **user-service** | 8001 | walking_pet_user | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€Tokenç”Ÿæˆ | Nacos, MySQL |
| **pet-service** | 8002 | walking_pet_pet | å® ç‰©æ¡£æ¡ˆç®¡ç† | Nacos, MySQL |
| **bulletin-service** | 8003 | walking_pet_bulletin | é›å® å…¬å‘Šå‘å¸ƒä¸ç®¡ç† | Nacos, MySQL |
| **sitter-service** | 8004 | walking_pet_sitter | é›å® å¸ˆå…¥é©»ä¸ä¿¡æ¯ç®¡ç† | Nacos, MySQL |
| **order-service** | 8005 | walking_pet_order | è®¢å•åˆ›å»ºã€æ¥å•ã€å®Œæˆ | Nacos, MySQL, Sitter, Pet |

#### 2.2.3 æœåŠ¡é—´è°ƒç”¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡è°ƒç”¨å…³ç³»                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Gateway Service (ç»Ÿä¸€å…¥å£)
    â”‚
    â”œâ”€â”€â†’ User Service (è®¤è¯æœåŠ¡)
    â”‚       â””â”€â”€ ç”ŸæˆJWT Token
    â”‚
    â”œâ”€â”€â†’ Pet Service (å® ç‰©æœåŠ¡)
    â”‚       â””â”€â”€ ç®¡ç†å® ç‰©æ¡£æ¡ˆ
    â”‚
    â”œâ”€â”€â†’ Bulletin Service (å…¬å‘ŠæœåŠ¡)
    â”‚       â””â”€â”€ å‘å¸ƒé›å® éœ€æ±‚
    â”‚
    â”œâ”€â”€â†’ Sitter Service (é›å® å¸ˆæœåŠ¡)
    â”‚       â””â”€â”€ é›å® å¸ˆå…¥é©»ä¸ä¿¡æ¯æŸ¥è¯¢
    â”‚
    â””â”€â”€â†’ Order Service (è®¢å•æœåŠ¡) â­æ ¸å¿ƒæœåŠ¡
            â”‚
            â”œâ”€â”€ OpenFeignè°ƒç”¨ â”€â”€â†’ Sitter Service
            â”‚                      â””â”€â”€ è·å–é›å® å¸ˆä¿¡æ¯
            â”‚
            â””â”€â”€ OpenFeignè°ƒç”¨ â”€â”€â†’ Pet Service (æ½œåœ¨)
                                   â””â”€â”€ è·å–å® ç‰©ä¿¡æ¯
```

### 2.3 æŠ€æœ¯æ¶æ„ç‰¹ç‚¹

1. **å¾®æœåŠ¡åŒ–**ï¼šä¸šåŠ¡æ‹†åˆ†ä¸º6ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œå„æœåŠ¡ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±•
2. **æœåŠ¡æ²»ç†**ï¼šNacoså®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œè‡ªåŠ¨å‰”é™¤ä¸å¥åº·å®ä¾‹
3. **APIç½‘å…³**ï¼šGatewayç»Ÿä¸€å…¥å£ï¼ŒJWTè®¤è¯ï¼Œè´Ÿè½½å‡è¡¡
4. **æ•°æ®éš”ç¦»**ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œé¿å…æ•°æ®è€¦åˆ
5. **å®¹å™¨åŒ–**ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ•°æ®åº“æ¶æ„

é¡¹ç›®é‡‡ç”¨ **æ•°æ®åº“åˆ†åº“** ç­–ç•¥ï¼Œæ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ï¼Œå®ç°æ•°æ®éš”ç¦»ï¼š

```
MySQL (3306)
â”œâ”€â”€ walking_pet_user      # ç”¨æˆ·æœåŠ¡æ•°æ®åº“
â”œâ”€â”€ walking_pet_pet       # å® ç‰©æœåŠ¡æ•°æ®åº“
â”œâ”€â”€ walking_pet_bulletin  # å…¬å‘ŠæœåŠ¡æ•°æ®åº“
â”œâ”€â”€ walking_pet_sitter    # é›å® å¸ˆæœåŠ¡æ•°æ®åº“
â””â”€â”€ walking_pet_order     # è®¢å•æœåŠ¡æ•°æ®åº“
```

### 3.2 æ ¸å¿ƒè¡¨è®¾è®¡

#### 3.2.1 ç”¨æˆ·è¡¨ (users)

**ä½ç½®**ï¼š`walking_pet_user.users`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| user_id | VARCHAR(50) | ä¸»é”®ï¼Œç”¨æˆ·ID |
| username | VARCHAR(50) | ç”¨æˆ·åï¼Œå”¯ä¸€ç´¢å¼• |
| password | VARCHAR(100) | MD5åŠ å¯†å¯†ç  |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

```sql
CREATE TABLE users (
    user_id VARCHAR(50) PRIMARY KEY COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç ï¼ˆMD5åŠ å¯†ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 3.2.2 å® ç‰©æ¡£æ¡ˆè¡¨ (pets)

**ä½ç½®**ï¼š`walking_pet_pet.pets`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| pet_id | VARCHAR(50) | ä¸»é”®ï¼Œå® ç‰©ID |
| user_id | VARCHAR(50) | æ‰€å±ç”¨æˆ·IDï¼Œç´¢å¼• |
| type | VARCHAR(20) | å® ç‰©ç±»å‹ï¼ˆçŒ«/ç‹—ï¼‰ |
| name | VARCHAR(50) | å® ç‰©åç§° |
| age | VARCHAR(20) | å¹´é¾„ |
| gender | VARCHAR(10) | æ€§åˆ« |
| weight | VARCHAR(20) | ä½“é‡ |
| breed | VARCHAR(50) | å“ç§ |
| aggressive | BOOLEAN | æ˜¯å¦æœ‰æ”»å‡»æ€§ |
| rabies_vaccine | BOOLEAN | æ˜¯å¦æ¥ç§ç‹‚çŠ¬ç–«è‹— |
| intro | TEXT | ç®€ä»‹ |
| image | LONGTEXT | Base64å›¾ç‰‡ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

#### 3.2.3 é›å® å…¬å‘Šè¡¨ (bulletins)

**ä½ç½®**ï¼š`walking_pet_bulletin.bulletins`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| bulletin_id | VARCHAR(50) | ä¸»é”®ï¼Œå…¬å‘ŠID |
| user_id | VARCHAR(50) | å‘å¸ƒäººID |
| service_type | VARCHAR(20) | æœåŠ¡ç±»å‹ï¼ˆfeed-cat/walk-dogï¼‰ |
| title | VARCHAR(100) | æ ‡é¢˜ |
| status | VARCHAR(20) | çŠ¶æ€ï¼ˆå¾…æ¥å•/å·²æ¥å•ï¼‰ |
| address | VARCHAR(200) | åœ°å€ |
| pet_id | VARCHAR(50) | å® ç‰©ID |
| pet_name | VARCHAR(50) | å® ç‰©åç§° |
| service_time | DATETIME | æœåŠ¡æ—¶é—´ |
| walker_gender | VARCHAR(10) | é›å® å¸ˆæ€§åˆ«åå¥½ |
| remark | TEXT | å¤‡æ³¨ |
| sitter_id | VARCHAR(50) | æ¥å•é›å® å¸ˆID |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

#### 3.2.4 é›å® å¸ˆè¡¨ (sitters)

**ä½ç½®**ï¼š`walking_pet_sitter.sitters`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| sitter_id | VARCHAR(50) | ä¸»é”®ï¼Œé›å® å¸ˆID |
| user_id | VARCHAR(50) | å…³è”ç”¨æˆ·IDï¼Œç´¢å¼• |
| name | VARCHAR(50) | å§“å |
| gender | VARCHAR(10) | æ€§åˆ« |
| slogan | TEXT | å£å· |
| rating | DECIMAL(2,1) | è¯„åˆ† |
| orders | INT | è®¢å•æ•° |
| distance | VARCHAR(20) | è·ç¦» |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

**å…³è”è¡¨**ï¼š
- `sitter_tags`ï¼šé›å® å¸ˆæ ‡ç­¾ï¼ˆä¸€å¯¹å¤šï¼‰
- `sitter_pets`ï¼šé›å® å¸ˆå® ç‰©å±•ç¤ºï¼ˆä¸€å¯¹å¤šï¼‰
- `sitter_services`ï¼šé›å® å¸ˆæœåŠ¡é…ç½®ï¼ˆä¸€å¯¹å¤šï¼‰

#### 3.2.5 è®¢å•è¡¨ (orders)

**ä½ç½®**ï¼š`walking_pet_order.orders`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| order_id | VARCHAR(50) | ä¸»é”®ï¼Œè®¢å•ID |
| user_id | VARCHAR(50) | ä¸‹å•ç”¨æˆ·IDï¼Œç´¢å¼• |
| sitter_id | VARCHAR(50) | é›å® å¸ˆIDï¼Œç´¢å¼• |
| sitter_name | VARCHAR(50) | é›å® å¸ˆå§“å |
| bulletin_id | VARCHAR(50) | å…³è”å…¬å‘ŠID |
| status | VARCHAR(20) | è®¢å•çŠ¶æ€ï¼Œç´¢å¼• |
| service_type | VARCHAR(20) | æœåŠ¡ç±»å‹ |
| service_time | DATETIME | æœåŠ¡æ—¶é—´ |
| address | VARCHAR(200) | åœ°å€ |
| pet_id | VARCHAR(50) | å® ç‰©ID |
| pet_name | VARCHAR(50) | å® ç‰©åç§° |
| remark | TEXT | å¤‡æ³¨ |
| complete_content | TEXT | å®Œæˆå†…å®¹ |
| complete_image | LONGTEXT | å®Œæˆå›¾ç‰‡ï¼ˆBase64ï¼‰ |
| completed_at | DATETIME | å®Œæˆæ—¶é—´ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### 3.3 æ•°æ®åº“ERå…³ç³»å›¾

```
Users (ç”¨æˆ·è¡¨)
  â”‚
  â”œâ”€â”€ 1:N â”€â”€â†’ Pets (å® ç‰©è¡¨)
  â”‚
  â”œâ”€â”€ 1:N â”€â”€â†’ Bulletins (å…¬å‘Šè¡¨)
  â”‚
  â”œâ”€â”€ 1:1 â”€â”€â†’ Sitters (é›å® å¸ˆè¡¨)
  â”‚              â”‚
  â”‚              â”œâ”€â”€ 1:N â”€â”€â†’ Sitter_Tags (æ ‡ç­¾è¡¨)
  â”‚              â”œâ”€â”€ 1:N â”€â”€â†’ Sitter_Pets (å® ç‰©å±•ç¤ºè¡¨)
  â”‚              â””â”€â”€ 1:N â”€â”€â†’ Sitter_Services (æœåŠ¡é…ç½®è¡¨)
  â”‚
  â””â”€â”€ 1:N â”€â”€â†’ Orders (è®¢å•è¡¨)
               â”‚
               â””â”€â”€ N:1 â”€â”€â†’ Sitters (é›å® å¸ˆè¡¨)
```

### 3.4 æ•°æ®åº“è®¾è®¡ç‰¹ç‚¹

1. **åˆ†åº“éš”ç¦»**ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œé¿å…æœåŠ¡é—´ç›´æ¥è®¿é—®æ•°æ®åº“
2. **ä¸»é”®ç­–ç•¥**ï¼šä¸šåŠ¡ä¸»é”®ä½¿ç”¨æœ‰æ„ä¹‰çš„å‰ç¼€ï¼ˆå¦‚ `u-`ã€`p-`ã€`o-`ï¼‰
3. **ç´¢å¼•ä¼˜åŒ–**ï¼šåœ¨å¸¸ç”¨æŸ¥è¯¢å­—æ®µï¼ˆuser_idã€statusï¼‰ä¸Šå»ºç«‹ç´¢å¼•
4. **å­—ç¬¦é›†**ï¼šç»Ÿä¸€ä½¿ç”¨ `utf8mb4` æ”¯æŒemojiå’Œç‰¹æ®Šå­—ç¬¦
5. **Base64å­˜å‚¨**ï¼šå›¾ç‰‡ä½¿ç”¨Base64å­—ç¬¦ä¸²å­˜å‚¨åœ¨LONGTEXTå­—æ®µä¸­

**SQLåˆå§‹åŒ–è„šæœ¬ä½ç½®**ï¼š`backend/sql/init.sql`

---

## å››ã€å…³é”®æŠ€æœ¯åŠè§£å†³æ–¹æ¡ˆ

### 4.1 æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

#### 4.1.1 ç”¨æˆ·èº«ä»½è®¤è¯ä¸æˆæƒ

**é—®é¢˜**ï¼š
- å¾®æœåŠ¡æ¶æ„ä¸‹å¦‚ä½•å®ç°ç»Ÿä¸€çš„èº«ä»½è®¤è¯ï¼Ÿ
- å¦‚ä½•é¿å…æ¯ä¸ªæœåŠ¡éƒ½å®ç°ä¸€éè®¤è¯é€»è¾‘ï¼Ÿ
- å¦‚ä½•å®‰å…¨åœ°ä¼ é€’ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šGateway + JWTç»Ÿä¸€è®¤è¯**

1. **JWT Tokenç”Ÿæˆä¸éªŒè¯**
   - ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒUser Serviceç”ŸæˆJWT Token
   - TokenåŒ…å«ç”¨æˆ·IDã€ç”¨æˆ·åã€è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯
   - Tokenæœ‰æ•ˆæœŸ24å°æ—¶

2. **Gatewayç»Ÿä¸€æ‹¦æˆªéªŒè¯**
   - æ‰€æœ‰è¯·æ±‚ç»è¿‡Gatewayï¼Œç»Ÿä¸€éªŒè¯JWT Token
   - ç™½åå•æ¥å£ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰ç›´æ¥æ”¾è¡Œ
   - éªŒè¯æˆåŠŸåï¼Œå°†ç”¨æˆ·IDæ³¨å…¥åˆ°è¯·æ±‚å¤´`X-User-Id`
   - ä¸‹æ¸¸æœåŠ¡ä»è¯·æ±‚å¤´è·å–ç”¨æˆ·IDï¼Œæ— éœ€å†æ¬¡éªŒè¯

3. **æŠ€æœ¯å®ç°**
   - ä½¿ç”¨ `io.jsonwebtoken.jjwt` åº“å®ç°JWT
   - Gatewayä½¿ç”¨WebFluxå“åº”å¼ç¼–ç¨‹
   - å…¨å±€è¿‡æ»¤å™¨`GlobalFilter`æ‹¦æˆªæ‰€æœ‰è¯·æ±‚

**ä¼˜åŠ¿**ï¼š
- âœ… è®¤è¯é€»è¾‘é›†ä¸­åœ¨Gatewayï¼Œä¸‹æ¸¸æœåŠ¡æ— éœ€å…³å¿ƒ
- âœ… æ— çŠ¶æ€è®¤è¯ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- âœ… Tokenæºå¸¦ç”¨æˆ·ä¿¡æ¯ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“

#### 4.1.2 æœåŠ¡é—´é€šä¿¡ä¸æ•°æ®èšåˆ

**é—®é¢˜**ï¼š
- Order Serviceéœ€è¦è·å–Sitter Serviceå’ŒPet Serviceçš„æ•°æ®
- å¦‚ä½•å®ç°æœåŠ¡é—´çš„HTTPè°ƒç”¨ï¼Ÿ
- å¦‚ä½•å¤„ç†æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šOpenFeignå£°æ˜å¼HTTPå®¢æˆ·ç«¯**

1. **Feignæ¥å£å®šä¹‰**
   - ä½¿ç”¨`@FeignClient`æ³¨è§£å£°æ˜è¿œç¨‹æœåŠ¡
   - æ¥å£æ–¹æ³•ä¸è¿œç¨‹æœåŠ¡æ¥å£ä¸€è‡´
   - è‡ªåŠ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–

2. **æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡**
   - Feigné€šè¿‡æœåŠ¡åä»Nacosè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
   - Spring Cloud LoadBalancerå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡
   - è‡ªåŠ¨å‰”é™¤ä¸å¥åº·å®ä¾‹

3. **é™çº§ä¸å®¹é”™**
   - å¯é…ç½®è¶…æ—¶æ—¶é—´å’Œé‡è¯•ç­–ç•¥
   - æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯

**æŠ€æœ¯å®ç°**ï¼š
```java
@FeignClient(name = "sitter-service", path = "/api/sitters")
public interface SitterFeignClient {
    @GetMapping("/my-info")
    Result<Map<String, Object>> getMySitterInfo(@RequestHeader("X-User-Id") String userId);
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… å£°æ˜å¼è°ƒç”¨ï¼Œä»£ç ç®€æ´
- âœ… è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- âœ… ä¸Spring Cloudç”Ÿæ€æ— ç¼é›†æˆ

#### 4.1.3 æœåŠ¡æ³¨å†Œä¸å‘ç°

**é—®é¢˜**ï¼š
- å¾®æœåŠ¡å®ä¾‹çš„IPå’Œç«¯å£å¯èƒ½åŠ¨æ€å˜åŒ–
- Gatewayå¦‚ä½•çŸ¥é“æŸä¸ªæœåŠ¡æœ‰å“ªäº›å®ä¾‹ï¼Ÿ
- å¦‚ä½•å®ç°æ•…éšœå®ä¾‹çš„è‡ªåŠ¨å‰”é™¤ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šNacosæœåŠ¡æ³¨å†Œä¸­å¿ƒ**

1. **æœåŠ¡è‡ªåŠ¨æ³¨å†Œ**
   - æ¯ä¸ªæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å‘Nacosæ³¨å†Œ
   - ä¸ŠæŠ¥æœåŠ¡åã€IPã€ç«¯å£ã€å¥åº·çŠ¶æ€

2. **æœåŠ¡åŠ¨æ€å‘ç°**
   - Gatewayå’ŒFeignå®¢æˆ·ç«¯ä»Nacosè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
   - æ”¯æŒæœåŠ¡å®ä¾‹çš„åŠ¨æ€ä¸Šä¸‹çº¿

3. **å¥åº·æ£€æŸ¥**
   - Nacoså®šæœŸæ£€æŸ¥æœåŠ¡å®ä¾‹å¥åº·çŠ¶æ€
   - ä¸å¥åº·çš„å®ä¾‹è‡ªåŠ¨æ ‡è®°å¹¶å‰”é™¤

**ä¼˜åŠ¿**ï¼š
- âœ… æœåŠ¡åœ°å€è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… æ”¯æŒæœåŠ¡çš„åŠ¨æ€æ‰©ç¼©å®¹
- âœ… æ•…éšœå®ä¾‹è‡ªåŠ¨éš”ç¦»

#### 4.1.4 æ•°æ®ä¸€è‡´æ€§é—®é¢˜

**é—®é¢˜**ï¼š
- è®¢å•åˆ›å»ºæ—¶éœ€è¦å…³è”å® ç‰©å’Œé›å® å¸ˆä¿¡æ¯
- å¦‚æœSitter Serviceæˆ–Pet Serviceä¸å¯ç”¨æ€ä¹ˆåŠï¼Ÿ
- æ•°æ®è·¨æœåŠ¡å¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šæ•°æ®å†—ä½™ + æœ€ç»ˆä¸€è‡´æ€§**

1. **æ•°æ®å†—ä½™å­˜å‚¨**
   - è®¢å•è¡¨å­˜å‚¨å¿…è¦çš„å® ç‰©å’Œé›å® å¸ˆä¿¡æ¯å¿«ç…§
   - å­—æ®µï¼š`pet_name`, `pet_type`, `sitter_name`
   - é¿å…é¢‘ç¹è·¨æœåŠ¡æŸ¥è¯¢

2. **åˆ›å»ºæ—¶åŒæ­¥æ ¡éªŒ**
   - è®¢å•åˆ›å»ºæ—¶é€šè¿‡FeignåŒæ­¥è°ƒç”¨éªŒè¯æ•°æ®å­˜åœ¨æ€§
   - è°ƒç”¨å¤±è´¥åˆ™è®¢å•åˆ›å»ºå¤±è´¥

3. **æŸ¥è¯¢æ—¶èšåˆæ•°æ®**
   - æŸ¥è¯¢è®¢å•è¯¦æƒ…æ—¶ï¼Œå®æ—¶è°ƒç”¨å…¶ä»–æœåŠ¡è·å–æœ€æ–°æ•°æ®
   - è°ƒç”¨å¤±è´¥åˆ™ä½¿ç”¨å¿«ç…§æ•°æ®

**ä¼˜åŠ¿**ï¼š
- âœ… æå‡æŸ¥è¯¢æ€§èƒ½
- âœ… é™ä½æœåŠ¡é—´è€¦åˆ
- âœ… éƒ¨åˆ†æœåŠ¡æ•…éšœä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

#### 4.1.5 å›¾ç‰‡å­˜å‚¨æ–¹æ¡ˆ

**é—®é¢˜**ï¼š
- å® ç‰©å›¾ç‰‡ã€é›å® å¸ˆå±•ç¤ºå›¾ç‰‡ã€è®¢å•å®Œæˆå›¾ç‰‡å¦‚ä½•å­˜å‚¨ï¼Ÿ
- æ˜¯å¦éœ€è¦æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šBase64å†…åµŒå­˜å‚¨**

1. **å‰ç«¯å¤„ç†**
   - ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡é€šè¿‡`FileReader.readAsDataURL()`è½¬ä¸ºBase64
   - å‰ç«¯ç›´æ¥å‘é€Base64å­—ç¬¦ä¸²åˆ°åç«¯

2. **åç«¯å­˜å‚¨**
   - åç«¯å°†Base64å­—ç¬¦ä¸²å­˜å‚¨åœ¨æ•°æ®åº“LONGTEXTå­—æ®µ
   - æŸ¥è¯¢æ—¶ç›´æ¥è¿”å›Base64å­—ç¬¦ä¸²

3. **ä¼˜ç¼ºç‚¹**
   - âœ… å®ç°ç®€å•ï¼Œæ— éœ€é¢å¤–æ–‡ä»¶æœåŠ¡å™¨
   - âœ… æ•°æ®å’Œå›¾ç‰‡ä¸€èµ·å¤‡ä»½
   - âŒ æ•°æ®åº“ä½“ç§¯å¢å¤§
   - âŒ æŸ¥è¯¢æ€§èƒ½ä¸‹é™

**æ”¹è¿›æ–¹æ¡ˆ**ï¼ˆæœªå®æ–½ï¼‰ï¼š
- ä½¿ç”¨é˜¿é‡Œäº‘OSS/è…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨
- æˆ–ä½¿ç”¨MinIOè‡ªå»ºå¯¹è±¡å­˜å‚¨
- æ•°æ®åº“åªå­˜å‚¨å›¾ç‰‡URL

#### 4.1.6 è·¨åŸŸé—®é¢˜

**é—®é¢˜**ï¼š
- å‰ç«¯(localhost:5173)è®¿é—®åç«¯(localhost:8000)äº§ç”Ÿè·¨åŸŸé”™è¯¯
- OPTIONSé¢„æ£€è¯·æ±‚è¢«æ‹¦æˆª

**è§£å†³æ–¹æ¡ˆï¼šGatewayç»Ÿä¸€CORSé…ç½®**

```yaml
spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: 
              - "http://localhost:5173"
              - "http://localhost:8080"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç»Ÿä¸€é…ç½®ï¼Œæ— éœ€æ¯ä¸ªæœåŠ¡å•ç‹¬é…ç½®
- âœ… æ”¯æŒå¤šä¸ªå‰ç«¯åœ°å€

---

## äº”ã€æ ¸å¿ƒä»£ç ä½ç½®åŠå®ç°

### 5.1 JWTè®¤è¯å®ç°

#### 5.1.1 JWTå·¥å…·ç±»

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-common/common-security/src/main/java/com/walkingpet/common/security/utils/JwtUtil.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
public class JwtUtil {
    // å¯†é’¥
    private static final String SECRET = "walking-pet-secret-key...";
    
    // è¿‡æœŸæ—¶é—´ï¼š24å°æ—¶
    private static final long EXPIRATION = 86400000L;

    /**
     * ç”ŸæˆToken
     */
    public static String generateToken(String userId, String username) {
        Date now = new Date();
        Date expiration = new Date(now.getTime() + EXPIRATION);

        return Jwts.builder()
                .setSubject(userId)
                .claim("username", username)
                .setIssuedAt(now)
                .setExpiration(expiration)
                .signWith(getSignKey(), SignatureAlgorithm.HS256)
                .compact();
    }

    /**
     * éªŒè¯Tokenå¹¶è·å–ç”¨æˆ·ID
     */
    public static String validateToken(String token) {
        try {
            Claims claims = Jwts.parserBuilder()
                    .setSigningKey(getSignKey())
                    .build()
                    .parseClaimsJws(token)
                    .getBody();
            return claims.getSubject(); // è¿”å›userId
        } catch (Exception e) {
            return null;
        }
    }
}
```

**æˆªå›¾å»ºè®®**ï¼š
- æ‰“å¼€ `JwtUtil.java` æ–‡ä»¶
- æˆªå›¾ `generateToken()` æ–¹æ³•ï¼ˆç¬¬28-40è¡Œï¼‰
- æˆªå›¾ `validateToken()` æ–¹æ³•ï¼ˆç¬¬45-57è¡Œï¼‰

#### 5.1.2 ç”¨æˆ·ç™»å½•ç”ŸæˆToken

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-user-service/src/main/java/com/walkingpet/user/service/UserService.java
```

**æ ¸å¿ƒä»£ç **ï¼ˆç¬¬79-107è¡Œï¼‰ï¼š
```java
public UserResponse login(LoginRequest request) {
    // æŸ¥è¯¢ç”¨æˆ·
    LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
    wrapper.eq(User::getUsername, request.getUsername());
    User user = userMapper.selectOne(wrapper);

    if (user == null) {
        throw new BusinessException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }

    // éªŒè¯å¯†ç 
    if (!PasswordUtil.verify(request.getPassword(), user.getPassword())) {
        throw new BusinessException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }

    // ç”ŸæˆToken
    String token = JwtUtil.generateToken(user.getUserId(), user.getUsername());

    // è¿”å›ç»“æœ
    UserResponse response = new UserResponse();
    response.setUserId(user.getUserId());
    response.setUsername(user.getUsername());
    response.setToken(token);  // â† è¿”å›Tokenç»™å‰ç«¯

    return response;
}
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾ç¬¬95-107è¡Œï¼Œé‡ç‚¹æ˜¯Tokenç”Ÿæˆå’Œè¿”å›

#### 5.1.3 Gatewayç»Ÿä¸€è®¤è¯

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-gateway/src/main/java/com/walkingpet/gateway/filter/AuthFilter.java
```

**æ ¸å¿ƒä»£ç **ï¼ˆç¬¬32-65è¡Œï¼‰ï¼š
```java
@Override
public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
    String path = exchange.getRequest().getPath().value();
    
    // ç™½åå•ç›´æ¥æ”¾è¡Œ
    if (isWhiteList(path)) {
        return chain.filter(exchange);
    }

    // è·å–Token
    String token = exchange.getRequest().getHeaders().getFirst("Authorization");
    if (token == null || !token.startsWith("Bearer ")) {
        log.warn("æœªæºå¸¦Token: {}", path);
        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
        return exchange.getResponse().setComplete();
    }

    // éªŒè¯Token
    String userId = JwtUtil.validateToken(token.substring(7));
    if (userId == null) {
        log.warn("TokenéªŒè¯å¤±è´¥: {}", path);
        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
        return exchange.getResponse().setComplete();
    }

    // å°†userIdæ³¨å…¥åˆ°è¯·æ±‚å¤´ï¼Œä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
    ServerHttpRequest request = exchange.getRequest().mutate()
            .header("X-User-Id", userId)
            .build();

    return chain.filter(exchange.mutate().request(request).build());
}
```

**æˆªå›¾å»ºè®®**ï¼š
- æˆªå›¾ `filter()` æ–¹æ³•æ ¸å¿ƒé€»è¾‘ï¼ˆç¬¬40-65è¡Œï¼‰
- é‡ç‚¹æ ‡æ³¨ï¼šTokenéªŒè¯ + ç”¨æˆ·IDæ³¨å…¥è¯·æ±‚å¤´

### 5.2 æœåŠ¡é—´è°ƒç”¨å®ç°ï¼ˆOpenFeignï¼‰

#### 5.2.1 Feignå®¢æˆ·ç«¯æ¥å£å®šä¹‰

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-order-service/src/main/java/com/walkingpet/order/feign/SitterFeignClient.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@FeignClient(name = "sitter-service", path = "/api/sitters")
public interface SitterFeignClient {
    
    /**
     * è·å–ç”¨æˆ·çš„å® æ‰˜å¸ˆä¿¡æ¯
     */
    @GetMapping("/my-info")
    Result<Map<String, Object>> getMySitterInfo(
        @RequestHeader("X-User-Id") String userId
    );
}
```

**è¯´æ˜**ï¼š
- `@FeignClient(name = "sitter-service")` æŒ‡å®šæœåŠ¡åï¼ŒFeignä¼šä»Nacosè·å–å®ä¾‹
- æ¥å£æ–¹æ³•ä¸Sitter Serviceçš„Controlleræ¥å£ä¸€è‡´
- æ— éœ€æ‰‹åŠ¨HTTPè°ƒç”¨ï¼ŒSpringè‡ªåŠ¨å®ç°

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾æ•´ä¸ªæ¥å£æ–‡ä»¶

#### 5.2.2 å¯ç”¨Feignå®¢æˆ·ç«¯

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-order-service/src/main/java/com/walkingpet/order/OrderServiceApplication.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients  // â† å¯ç”¨Feignå®¢æˆ·ç«¯
@MapperScan("com.walkingpet.order.mapper")
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾å¯åŠ¨ç±»ï¼Œæ ‡æ³¨ `@EnableFeignClients` æ³¨è§£

#### 5.2.3 Feignå®¢æˆ·ç«¯è°ƒç”¨

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-order-service/src/main/java/com/walkingpet/order/service/OrderService.java
```

**æ ¸å¿ƒä»£ç **ï¼ˆç¬¬28-31è¡Œå’Œç¬¬144-153è¡Œï¼‰ï¼š
```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;
    
    @Autowired
    private SitterFeignClient sitterFeignClient;  // â† æ³¨å…¥Feignå®¢æˆ·ç«¯

    /**
     * å® æ‰˜å¸ˆæ¥å•
     */
    public Order acceptOrder(String orderId, String sitterUserId) {
        Order order = orderMapper.selectById(orderId);
        
        // æŸ¥è¯¢å® æ‰˜å¸ˆåå­—
        String sitterName = null;
        try {
            // â† Feignè°ƒç”¨Sitter Service
            Result<Map<String, Object>> sitterInfo = 
                sitterFeignClient.getMySitterInfo(sitterUserId);
            
            if (sitterInfo != null && sitterInfo.getSuccess()) {
                sitterName = (String) sitterInfo.getBody().get("name");
            }
        } catch (Exception e) {
            log.error("æŸ¥è¯¢å® æ‰˜å¸ˆä¿¡æ¯å¤±è´¥", e);
        }

        order.setStatus("å·²æ¥å•");
        order.setSitterName(sitterName);
        orderMapper.updateById(order);
        
        return order;
    }
}
```

**æˆªå›¾å»ºè®®**ï¼š
- æˆªå›¾Feignå®¢æˆ·ç«¯æ³¨å…¥ï¼ˆç¬¬31è¡Œï¼‰
- æˆªå›¾Feignè°ƒç”¨ä»£ç ï¼ˆç¬¬144-153è¡Œï¼‰

### 5.3 æœåŠ¡æ³¨å†Œä¸å‘ç°

#### 5.3.1 Nacoså®¢æˆ·ç«¯é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-user-service/src/main/resources/application.yml
```

**æ ¸å¿ƒé…ç½®**ï¼š
```yaml
spring:
  application:
    name: user-service  # æœåŠ¡åï¼Œæ³¨å†Œåˆ°Nacos
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacosåœ°å€
        namespace: public
        group: DEFAULT_GROUP
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾Nacosé…ç½®éƒ¨åˆ†

#### 5.3.2 å¯ç”¨æœåŠ¡æ³¨å†Œ

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-user-service/src/main/java/com/walkingpet/user/UserServiceApplication.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@SpringBootApplication
@EnableDiscoveryClient  // â† å¯ç”¨æœåŠ¡æ³¨å†Œ
@MapperScan("com.walkingpet.user.mapper")
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾å¯åŠ¨ç±»ï¼Œæ ‡æ³¨ `@EnableDiscoveryClient` æ³¨è§£

#### 5.3.3 Nacosæ§åˆ¶å°

**è®¿é—®åœ°å€**ï¼š`http://localhost:8848/nacos`
- ç”¨æˆ·åï¼šnacos
- å¯†ç ï¼šnacos

**æŸ¥çœ‹å†…å®¹**ï¼š
- æœåŠ¡ç®¡ç† â†’ æœåŠ¡åˆ—è¡¨
- æŸ¥çœ‹å·²æ³¨å†Œçš„6ä¸ªæœåŠ¡

**æˆªå›¾å»ºè®®**ï¼š
- æˆªå›¾Nacosæ§åˆ¶å°æœåŠ¡åˆ—è¡¨
- æ˜¾ç¤ºæ‰€æœ‰6ä¸ªæœåŠ¡çš„å¥åº·çŠ¶æ€

### 5.4 å¯†ç åŠ å¯†å®ç°

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-common/common-security/src/main/java/com/walkingpet/common/security/utils/PasswordUtil.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
public class PasswordUtil {

    /**
     * å¯†ç åŠ å¯†ï¼ˆMD5ï¼‰
     */
    public static String encrypt(String password) {
        return SecureUtil.md5(password);
    }

    /**
     * å¯†ç éªŒè¯
     */
    public static boolean verify(String rawPassword, String encodedPassword) {
        return encrypt(rawPassword).equals(encodedPassword);
    }
}
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾æ•´ä¸ªå·¥å…·ç±»

### 5.5 ç»Ÿä¸€å“åº”æ ¼å¼

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-common/common-core/src/main/java/com/walkingpet/common/core/domain/Result.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@Data
public class Result<T> implements Serializable {
    private Boolean success;
    private String message;
    private T body;

    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setSuccess(true);
        result.setBody(data);
        return result;
    }

    public static <T> Result<T> fail(String message) {
        Result<T> result = new Result<>();
        result.setSuccess(false);
        result.setMessage(message);
        return result;
    }
}
```

**æˆªå›¾å»ºè®®**ï¼šæˆªå›¾ `success()` å’Œ `fail()` æ–¹æ³•

### 5.6 æ•°æ®åº“æ“ä½œï¼ˆMyBatis Plusï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š
```
backend/walking-pet-pet-service/src/main/java/com/walkingpet/pet/mapper/PetMapper.java
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@Mapper
public interface PetMapper extends BaseMapper<Pet> {
    // ç»§æ‰¿BaseMapperï¼Œè‡ªåŠ¨æ‹¥æœ‰CRUDæ–¹æ³•
    // - insert()
    // - selectById()
    // - selectList()
    // - updateById()
    // - deleteById()
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼ˆPetService.javaï¼‰ï¼š
```java
@Service
public class PetService {
    
    @Autowired
    private PetMapper petMapper;
    
    public Pet createPet(String userId, PetRequest request) {
        Pet pet = new Pet();
        pet.setPetId("p-" + System.currentTimeMillis());
        pet.setUserId(userId);
        pet.setName(request.getName());
        // ... è®¾ç½®å…¶ä»–å­—æ®µ
        
        petMapper.insert(pet);  // â† MyBatis Plusè‡ªåŠ¨ç”ŸæˆSQL
        return pet;
    }
}
```

**æˆªå›¾å»ºè®®**ï¼š
- æˆªå›¾ Mapperæ¥å£
- æˆªå›¾ Serviceä¸­çš„ä½¿ç”¨ç¤ºä¾‹

---

## å…­ã€é¡¹ç›®éƒ¨ç½²ä¸è¿è¡Œ

### 6.1 Dockerä¸€é”®éƒ¨ç½²

**æ­¥éª¤**ï¼š

1. **æ„å»ºJARåŒ…**
```bash
cd backend
mvn clean package -DskipTests
```

2. **å¯åŠ¨æ‰€æœ‰æœåŠ¡**
```bash
docker-compose up -d
```

3. **æŸ¥çœ‹è¿è¡ŒçŠ¶æ€**
```bash
docker-compose ps
```

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
docker-compose logs -f gateway
```

### 6.2 è®¿é—®åœ°å€

- **APIç½‘å…³**ï¼šhttp://localhost:8000
- **Nacosæ§åˆ¶å°**ï¼šhttp://localhost:8848/nacos
- **å‰ç«¯**ï¼šhttp://localhost:5173

### 6.3 æµ‹è¯•æ¥å£

**ç”¨æˆ·æ³¨å†Œ**ï¼š
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456","confirmPassword":"123456"}'
```

**ç”¨æˆ·ç™»å½•**ï¼š
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'
```

---

## ä¸ƒã€å¼€å‘å·¥ä½œæ€»ç»“

### 7.1 å®Œæˆçš„åŠŸèƒ½æ¨¡å—

#### âœ… åŸºç¡€è®¾æ–½å±‚
- [x] NacosæœåŠ¡æ³¨å†Œä¸å‘ç°
- [x] MySQLæ•°æ®åº“åˆ†åº“è®¾è®¡
- [x] Dockerå®¹å™¨åŒ–éƒ¨ç½²
- [x] ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- [x] ç»Ÿä¸€å“åº”æ ¼å¼

#### âœ… è®¤è¯æˆæƒå±‚
- [x] JWT Tokenç”Ÿæˆä¸éªŒè¯
- [x] Gatewayç»Ÿä¸€è®¤è¯æ‹¦æˆª
- [x] ç”¨æˆ·IDæ³¨å…¥è¯·æ±‚å¤´
- [x] å¯†ç MD5åŠ å¯†

#### âœ… ä¸šåŠ¡æœåŠ¡å±‚
- [x] ç”¨æˆ·æ³¨å†Œã€ç™»å½•
- [x] å® ç‰©æ¡£æ¡ˆCRUD
- [x] é›å® å…¬å‘Šå‘å¸ƒä¸ç®¡ç†
- [x] é›å® å¸ˆå…¥é©»ä¸ä¿¡æ¯å±•ç¤º
- [x] è®¢å•åˆ›å»ºã€æ¥å•ã€å®Œæˆ
- [x] æœåŠ¡é—´Feignè°ƒç”¨

#### âœ… å‰ç«¯é›†æˆ
- [x] Axiosè¯·æ±‚å°è£…
- [x] Tokenè‡ªåŠ¨æ³¨å…¥
- [x] ç™»å½•çŠ¶æ€ç®¡ç†
- [x] æ‰€æœ‰é¡µé¢ä¸åç«¯å¯¹æ¥

### 7.2 æ ¸å¿ƒæŠ€æœ¯ç‚¹å›é¡¾

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹å¼ | ä»£ç ä½ç½® |
|-------|---------|---------|
| **JWTè®¤è¯** | JwtUtilå·¥å…·ç±» | `common-security/utils/JwtUtil.java` |
| **Gatewayè®¤è¯** | AuthFilterå…¨å±€è¿‡æ»¤å™¨ | `gateway/filter/AuthFilter.java` |
| **æœåŠ¡è°ƒç”¨** | OpenFeignå£°æ˜å¼å®¢æˆ·ç«¯ | `order-service/feign/SitterFeignClient.java` |
| **æœåŠ¡æ³¨å†Œ** | @EnableDiscoveryClient | å„æœåŠ¡å¯åŠ¨ç±» |
| **è´Ÿè½½å‡è¡¡** | Spring Cloud LoadBalancer | pom.xmlä¾èµ– |
| **å¯†ç åŠ å¯†** | Hutool MD5 | `common-security/utils/PasswordUtil.java` |
| **ORMæ¡†æ¶** | MyBatis Plus | å„æœåŠ¡Mapperæ¥å£ |
| **æ•°æ®åº“åˆå§‹åŒ–** | SQLè„šæœ¬ | `backend/sql/init.sql` |

### 7.3 æŠ€æœ¯äº®ç‚¹

1. **å¾®æœåŠ¡æ¶æ„å®Œæ•´å®ç°**
   - 6ä¸ªç‹¬ç«‹å¾®æœåŠ¡
   - æœåŠ¡æ³¨å†Œä¸å‘ç°
   - æœåŠ¡é—´è°ƒç”¨
   - æ•°æ®åº“åˆ†åº“

2. **ç»Ÿä¸€è®¤è¯æˆæƒ**
   - Gatewayé›†ä¸­è®¤è¯
   - JWTæ— çŠ¶æ€Token
   - ç”¨æˆ·IDé€ä¼ 

3. **å£°æ˜å¼æœåŠ¡è°ƒç”¨**
   - OpenFeignç®€åŒ–HTTPè°ƒç”¨
   - è‡ªåŠ¨è´Ÿè½½å‡è¡¡
   - æœåŠ¡å‘ç°é›†æˆ

4. **å®¹å™¨åŒ–éƒ¨ç½²**
   - Dockeré•œåƒ
   - Docker Composeç¼–æ’
   - ä¸€é”®å¯åŠ¨

5. **å‰åç«¯åˆ†ç¦»**
   - RESTful API
   - ç»Ÿä¸€å“åº”æ ¼å¼
   - å®Œæ•´çš„å‰ç«¯å¯¹æ¥

### 7.4 å¯ä¼˜åŒ–æ–¹å‘

1. **ç›‘æ§å‘Šè­¦**ï¼šé›†æˆPrometheus + Grafana
2. **é“¾è·¯è¿½è¸ª**ï¼šé›†æˆSkywalkingæˆ–Zipkin
3. **é…ç½®ä¸­å¿ƒ**ï¼šä½¿ç”¨Nacos Configç»Ÿä¸€é…ç½®
4. **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šé›†æˆRabbitMQå®ç°å¼‚æ­¥é€šçŸ¥
5. **ç¼“å­˜ä¼˜åŒ–**ï¼šRedisç¼“å­˜çƒ­ç‚¹æ•°æ®
6. **å›¾ç‰‡å­˜å‚¨**ï¼šä½¿ç”¨å¯¹è±¡å­˜å‚¨æ›¿ä»£Base64
7. **ç†”æ–­é™çº§**ï¼šé›†æˆSentinel
8. **æ—¥å¿—èšåˆ**ï¼šELKæ—¥å¿—åˆ†æå¹³å°

---

## å…«ã€é™„å½•

### 8.1 é¡¹ç›®ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ pom.xml                              # çˆ¶POM
â”œâ”€â”€ docker-compose.yml                   # Dockerç¼–æ’
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ init.sql                         # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ walking-pet-common/                  # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ common-core/                     # æ ¸å¿ƒå·¥å…·
â”‚   â”‚   â””â”€â”€ src/main/java/.../domain/
â”‚   â”‚       â””â”€â”€ Result.java              # ç»Ÿä¸€å“åº”
â”‚   â””â”€â”€ common-security/                 # å®‰å…¨æ¨¡å—
â”‚       â””â”€â”€ src/main/java/.../utils/
â”‚           â”œâ”€â”€ JwtUtil.java             # JWTå·¥å…·
â”‚           â””â”€â”€ PasswordUtil.java        # å¯†ç åŠ å¯†
â”œâ”€â”€ walking-pet-gateway/                 # ç½‘å…³æœåŠ¡
â”‚   â””â”€â”€ src/main/java/.../filter/
â”‚       â””â”€â”€ AuthFilter.java              # è®¤è¯è¿‡æ»¤å™¨
â”œâ”€â”€ walking-pet-user-service/            # ç”¨æˆ·æœåŠ¡
â”‚   â””â”€â”€ src/main/java/
â”‚       â”œâ”€â”€ controller/AuthController.java
â”‚       â”œâ”€â”€ service/UserService.java
â”‚       â””â”€â”€ mapper/UserMapper.java
â”œâ”€â”€ walking-pet-pet-service/             # å® ç‰©æœåŠ¡
â”œâ”€â”€ walking-pet-bulletin-service/        # å…¬å‘ŠæœåŠ¡
â”œâ”€â”€ walking-pet-sitter-service/          # é›å® å¸ˆæœåŠ¡
â””â”€â”€ walking-pet-order-service/           # è®¢å•æœåŠ¡
    â””â”€â”€ src/main/java/
        â”œâ”€â”€ feign/SitterFeignClient.java # Feignå®¢æˆ·ç«¯
        â””â”€â”€ service/OrderService.java
```

### 8.2 æŠ€æœ¯æ–‡æ¡£å‚è€ƒ

- **Spring Cloudå®˜æ–¹æ–‡æ¡£**ï¼šhttps://spring.io/projects/spring-cloud
- **Nacoså®˜æ–¹æ–‡æ¡£**ï¼šhttps://nacos.io/docs/
- **MyBatis Pluså®˜æ–¹æ–‡æ¡£**ï¼šhttps://baomidou.com/
- **JWTå®˜æ–¹æ–‡æ¡£**ï¼šhttps://jwt.io/

---

## ç»“è¯­

Walking Peté¡¹ç›®å®Œæ•´å®ç°äº†åŸºäºSpring Cloudå¾®æœåŠ¡æ¶æ„çš„å® ç‰©é›å…»æœåŠ¡å¹³å°ï¼Œæ¶µç›–äº†å¾®æœåŠ¡å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ç‚¹ï¼š

- âœ… **æœåŠ¡æ²»ç†**ï¼šNacosæ³¨å†Œä¸­å¿ƒ
- âœ… **APIç½‘å…³**ï¼šSpring Cloud Gateway
- âœ… **æœåŠ¡è°ƒç”¨**ï¼šOpenFeign
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šLoadBalancer
- âœ… **è®¤è¯æˆæƒ**ï¼šJWT + Gatewayç»Ÿä¸€è®¤è¯
- âœ… **æ•°æ®è®¿é—®**ï¼šMyBatis Plus
- âœ… **å®¹å™¨åŒ–**ï¼šDocker + Docker Compose

é¡¹ç›®ä»£ç ç»“æ„æ¸…æ™°ï¼ŒæŠ€æœ¯é€‰å‹ä¸»æµï¼Œé€‚åˆä½œä¸ºå¾®æœåŠ¡å­¦ä¹ é¡¹ç›®æˆ–äºŒæ¬¡å¼€å‘åŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¶é—´**ï¼š2025-12-30  
**ä½œè€…**ï¼šWalking Pet Team
